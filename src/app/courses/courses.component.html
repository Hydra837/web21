<!-- Section pour afficher la liste des cours -->
<div class="card courses-list shadow">
  <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
    <h2>Liste des Cours</h2>
    <div>
      <button class="btn btn-primary" (click)="showAddCourseForm()">Ajouter un Cours</button>
      <button class="btn btn-primary ms-2" (click)="showAddProfessorForm()">Ajouter un Professeur à un Cours</button>
    </div>
  </div>
  <div class="card-body">
    <table class="table table-striped table-hover">
      <thead class="thead-dark">
        <tr>
          <!-- <th>ID</th> -->
          <th>Nom</th>
          <th>Description</th>
          <th>Date de Début</th>
          <th>Date de Fin</th>
          <th>Disponible</th>
          <th>Professeur</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let course of courses">
          <!-- <td>{{ course.id }}</td> -->
          <td>{{ course.Nom }}</td>
          <td>{{ course.description }}</td>
          <td>{{ course.dateDebut | date: 'shortDate' }}</td>
          <td>{{ course.dateFin | date: 'shortDate' }}</td>
          <td>{{ course.available ? 'Oui' : 'Non' }}</td>
          <td>{{ course.professeurId ? 'Assigné' : 'Non assigné' }}</td>
   <!-- Column for actions -->
<td>
  <button class="btn btn-warning btn-sm me-1" (click)="updateCourse(course.id!)">Modifier</button>
  <button class="btn btn-danger btn-sm me-1" [disabled]="isProfessor" (click)="deleteCourse(course.id!)">Supprimer</button>
  <button class="btn btn-info btn-sm me-1" (click)="showEnrolledUsers(course.id!)">Voir Utilisateurs</button>
  <button class="btn btn-primary btn-sm" (click)="showAssignments(course.id!)">Voir Assignements</button>
</td>

        </tr>
      </tbody>
    </table>
  </div>
</div>

<div *ngIf="showAddCourseFormFlag" class="card mb-4 add-course-form shadow">
  <div class="card-header bg-primary text-white">
    <h2>Ajouter un Cours</h2>
  </div>
  <div class="card-body">
    <form [formGroup]="addCourseForm" (ngSubmit)="submitNewCourse()">
      <div class="mb-3">
        <label for="courseName" class="form-label">Nom du Cours :</label>
        <input id="courseName" class="form-control" formControlName="Nom" required>
      </div>
      <div class="mb-3">
        <label for="courseDescription" class="form-label">Description :</label>
        <textarea id="courseDescription" class="form-control" formControlName="description" required></textarea>
      </div>
      <div class="mb-3">
        <label for="courseStartDate" class="form-label">Date de Début :</label>
        <input type="date" id="courseStartDate" class="form-control" formControlName="dateDebut" required>
      </div>
      <div class="mb-3">
        <label for="courseEndDate" class="form-label">Date de Fin :</label>
        <input type="date" id="courseEndDate" class="form-control" formControlName="dateFin" required>
      </div>
      <div class="mb-3 form-check">
        <input type="checkbox" id="courseAvailable" class="form-check-input" formControlName="available">
        <label for="courseAvailable" class="form-check-label">Disponible</label>
      </div>
      <!-- Ajouter un champ caché ou désactiver le champ de sélection du professeur -->
      <div *ngIf="userRole !== 'Professeur'" class="mb-3">
        <label for="professorSelect" class="form-label">Sélectionnez un Professeur :</label>
        <select id="professorSelect" formControlName="selectedProfessorId" class="form-select">
          <option *ngFor="let user of filteredUsers" [value]="user.id">{{ user.nom }}</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Ajouter</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="cancelAddCourse()">Annuler</button>
    </form>
  </div>
</div>

<!-- Formulaire pour ajouter un professeur à un cours -->
<div *ngIf="showProfessorForm" class="card mb-4 shadow">
  <div class="card-header bg-primary text-white">
    <h2>Ajouter un Professeur au Cours</h2>
  </div>
  <div class="card-body">
    <form [formGroup]="addProfessorForm" (ngSubmit)="confirmAddProfessor()">
      <div class="mb-3">
        <label for="professorSelect" class="form-label">Sélectionnez un Professeur :</label>
        <select id="professorSelect" formControlName="selectedProfessorId" class="form-select" required>
          <option *ngFor="let user of filteredUsers" [value]="user.id">{{ user.nom }}</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="courseSelect" class="form-label">Sélectionnez un Cours :</label>
        <select id="courseSelect" formControlName="selectedCourseId" class="form-select" required>
          <option *ngFor="let course of courses" [value]="course.id">{{ course.Nom }}</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Ajouter</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="cancelAddProfessor()">Annuler</button>
    </form>
  </div>
</div>

<!-- Formulaire pour mettre à jour un cours -->
<div *ngIf="selectedCourse" class="card mb-4 update-course-form shadow">
  <div class="card-header bg-warning text-white">
    <h2>Modifier le Cours</h2>
  </div>
  <div class="card-body">
    <form [formGroup]="updateCourseForm" (ngSubmit)="saveUpdatedCourse()">
      <div class="mb-3">
        <label for="updateCourseName" class="form-label">Nom du Cours :</label>
        <input id="updateCourseName" class="form-control" formControlName="Nom" required>
      </div>
      <div class="mb-3">
        <label for="updateCourseDescription" class="form-label">Description :</label>
        <textarea id="updateCourseDescription" class="form-control" formControlName="description" required></textarea>
      </div>
      <div class="mb-3">
        <label for="updateCourseStartDate" class="form-label">Date de Début :</label>
        <input type="date" id="updateCourseStartDate" class="form-control" formControlName="dateDebut" required>
      </div>
      <div class="mb-3">
        <label for="updateCourseEndDate" class="form-label">Date de Fin :</label>
        <input type="date" id="updateCourseEndDate" class="form-control" formControlName="dateFin" required>
      </div>
      <div class="mb-3 form-check">
        <input type="checkbox" id="updateCourseAvailable" class="form-check-input" formControlName="available">
        <label for="updateCourseAvailable" class="form-check-label">Disponible</label>
      </div>
      <button type="submit" class="btn btn-warning">Mettre à jour</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="cancelUpdate()">Annuler</button>
    </form>
  </div>
</div>

<!-- Bouton pour afficher le component EnrollStudent -->
<button class="btn btn-secondary mb-4" 
        [disabled]="isProfesseur()" 
        (click)="openEnrollStudentDialog()">
  <i class="fas fa-chalkboard-teacher me-2"></i> Inscrire un Étudiant
</button>

<!-- Formulaire pour afficher les utilisateurs inscrits et leurs notes -->
<div *ngIf="selectedCourseWithUsers" class="card mb-4 enrolled-users-form shadow">
  <div class="card-header bg-info text-white">
    <h2>Utilisateurs inscrits pour le cours {{ selectedCourseWithUsers.Nom }}</h2>
  </div>
  <div class="card-body">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Note</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of enrolledUsers">
          <td>{{ user.nom }} {{ user.prenom }}</td>
          <td>
            <input [(ngModel)]="user.grade" type="number" min="0" max="20" class="form-control" style="width: 80px;" />
          </td>
          <td>
            <button class="btn btn-danger btn-sm me-1" (click)="deleteEnrollment(user.id, selectedCourseWithUsers.id!)">Supprimer Inscription</button>
            <button class="btn btn-success btn-sm" (click)="updateGrade(user.id, selectedCourseWithUsers?.id || 0, user.grade)">Mettre à jour la Note</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="btn btn-secondary" (click)="cancelShowEnrolledUsers()">Annuler</button>
  </div>
</div>

<!-- Composant Assignements affiché conditionnellement -->
<app-assignements *ngIf="selectedCourseIdForAssignments" [courseId]="selectedCourseIdForAssignments"></app-assignements>
