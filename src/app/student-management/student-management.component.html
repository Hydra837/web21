<div class="container mt-5">
  <h1 class="mb-4 text-primary">User Management</h1>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Filtrage des utilisateurs -->
  <div class="mb-4">
    <label for="roleFilter" class="form-label">Filter by Role:</label>
    <select id="roleFilter" class="form-select" [(ngModel)]="selectedRole" (change)="filterUsers()">
      <option value="">All Roles</option>
      <option value="Etudiant">Étudiant</option>
      <option value="Professeur">Professeur</option>
      <option value="Admin">Admin</option>
    </select>
  </div>

  <!-- Tableau des utilisateurs -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Pseudo</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>{{ user.id }}</td>
          <td>{{ user.nom }}</td>
          <td>{{ user.prenom }}</td>
          <td>{{ user.pseudo }}</td>
          <td>{{ user.mail }}</td>
          <td>{{ user.role }}</td>
          <td>
            <button class="btn btn-warning btn-sm me-2" (click)="selectUser(user)">
              <i class="fas fa-edit me-1"></i>Edit
            </button>
            <button class="btn btn-danger btn-sm me-2" (click)="deleteUser(user.id)">
              <i class="fas fa-trash me-1"></i>Delete
            </button>
            <!-- Bouton pour ajouter l'utilisateur à un cours -->
            <button class="btn btn-info btn-sm" (click)="openUserSelectionDialog(user.id)">
              <i class="fas fa-plus me-1"></i>Add to Course
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Bouton pour ajouter un utilisateur -->
  <button class="btn btn-primary mb-4" (click)="addUser()">
    <i class="fas fa-user-plus me-2"></i>Add User
  </button>

  <!-- Formulaire de modification d'utilisateur existant -->
  <div *ngIf="selectedUser" class="card p-4 mb-4 shadow-sm">
    <h2 class="card-title mb-4">Edit User</h2>
    <form (ngSubmit)="saveUser()">
      <div class="mb-3">
        <label for="nom" class="form-label">Nom:</label>
        <input id="nom" type="text" class="form-control" [(ngModel)]="selectedUser.nom" name="nom" required>
      </div>
      <div class="mb-3">
        <label for="prenom" class="form-label">Prénom:</label>
        <input id="prenom" type="text" class="form-control" [(ngModel)]="selectedUser.prenom" name="prenom" required>
      </div>
      <div class="mb-3">
        <label for="pseudo" class="form-label">Pseudo:</label>
        <input id="pseudo" type="text" class="form-control" [(ngModel)]="selectedUser.pseudo" name="pseudo" required>
      </div>
      <div class="mb-3">
        <label for="mail" class="form-label">Email:</label>
        <input id="mail" type="email" class="form-control" [(ngModel)]="selectedUser.mail" name="mail" required>
      </div>
      <div class="mb-3">
        <label for="role" class="form-label">Role:</label>
        <select id="role" class="form-select" [(ngModel)]="selectedUser.role" name="role" required>
          <option value="Etudiant">Étudiant</option>
          <option value="Professeur">Professeur</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success me-2">
        <i class="fas fa-save me-1"></i>Save
      </button>
      <button type="button" class="btn btn-secondary" (click)="selectedUser = null">
        <i class="fas fa-times me-1"></i>Cancel
      </button>
    </form>
  </div>

  <!-- Formulaire d'ajout de nouvel utilisateur -->
  <div *ngIf="userForm" class="card p-4 mb-4 shadow-sm">
    <h2 class="card-title mb-4">Add User</h2>
    <form (ngSubmit)="saveNewUser()">
      <div class="mb-3">
        <label for="nom" class="form-label">Nom:</label>
        <input id="nom" type="text" class="form-control" [(ngModel)]="userForm.nom" name="nom" required>
      </div>
      <div class="mb-3">
        <label for="prenom" class="form-label">Prénom:</label>
        <input id="prenom" type="text" class="form-control" [(ngModel)]="userForm.prenom" name="prenom" required>
      </div>
      <div class="mb-3">
        <label for="pseudo" class="form-label">Pseudo:</label>
        <input id="pseudo" type="text" class="form-control" [(ngModel)]="userForm.pseudo" name="pseudo" required>
      </div>
      <div class="mb-3">
        <label for="mail" class="form-label">Email:</label>
        <input id="mail" type="email" class="form-control" [(ngModel)]="userForm.mail" name="mail" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password:</label>
        <input id="password" type="password" class="form-control" [(ngModel)]="userForm.password" name="password" required>
      </div>
      <div class="mb-3">
        <label for="role" class="form-label">Role:</label>
        <select id="role" class="form-select" [(ngModel)]="userForm.role" name="role" required>
          <option value="Etudiant">Étudiant</option>
          <option value="Professeur">Professeur</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success me-2">
        <i class="fas fa-save me-1"></i>Save
      </button>
      <button type="button" class="btn btn-secondary" (click)="userForm = null">
        <i class="fas fa-times me-1"></i>Cancel
      </button>
    </form>
  </div>
</div>
