<div class="container mt-5">
  <h1 class="mb-4 text-primary">User Management</h1>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Filtrage des utilisateurs -->
  <div class="mb-4">
    <label for="roleFilter" class="form-label">Filter by Role:</label>
    <select id="roleFilter" class="form-select" [(ngModel)]="selectedRole" (change)="filterUsers()">
      <option value="">All Roles</option>
      <option value="Etudiant">Étudiant</option>
      <option value="Professeur">Professeur</option>
      <option value="Admin">Admin</option>
    </select>
  </div>

  <!-- Tableau des utilisateurs -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Pseudo</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>{{ user.id }}</td>
          <td>{{ user.nom }}</td>
          <td>{{ user.prenom }}</td>
          <td>{{ user.pseudo }}</td>
          <td>{{ user.mail }}</td>
          <td>{{ user.role }}</td>
          <td>
            <button class="btn btn-warning btn-sm me-2" (click)="selectUser(user)">
              <i class="fas fa-edit me-1"></i>Edit
            </button>
            <button class="btn btn-danger btn-sm me-2" (click)="deleteUser(user.id)">
              <i class="fas fa-trash me-1"></i>Delete
            </button>
            <button class="btn btn-info btn-sm me-2" (click)="viewCoursesForUser(user.id)">
              <i class="fas fa-eye me-1"></i>View Courses
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Boutons pour ajouter et inscrire des étudiants -->
  <div class="mb-4">
    <!-- <button class="btn btn-primary me-2" (click)="openCreateUserDialog()">
      <i class="fas fa-user-plus me-2"></i>Add User
    </button> -->
    <button class="btn btn-secondary" [routerLink]="['/enroll-student']">
      <i class="fas fa-chalkboard-teacher me-2"></i>Enroll Student
    </button>
  </div>

  <!-- Formulaire de modification d'utilisateur existant -->
  <div *ngIf="selectedUser" class="card p-4 mb-4 shadow-sm">
    <h2 class="card-title mb-4">Edit User</h2>
    <form (ngSubmit)="saveUser()">
      <div class="mb-3">
        <label for="nom" class="form-label">Nom:</label>
        <input id="nom" type="text" class="form-control" [(ngModel)]="selectedUser.nom" name="nom" required>
      </div>
      <div class="mb-3">
        <label for="prenom" class="form-label">Prénom:</label>
        <input id="prenom" type="text" class="form-control" [(ngModel)]="selectedUser.prenom" name="prenom" required>
      </div>
      <div class="mb-3">
        <label for="pseudo" class="form-label">Pseudo:</label>
        <input id="pseudo" type="text" class="form-control" [(ngModel)]="selectedUser.pseudo" name="pseudo" required>
      </div>
      <div class="mb-3">
        <label for="mail" class="form-label">Email:</label>
        <input id="mail" type="email" class="form-control" [(ngModel)]="selectedUser.mail" name="mail" required>
      </div>
      <div class="mb-3">
        <label for="role" class="form-label">Role:</label>
        <select id="role" class="form-select" [(ngModel)]="selectedUser.role" name="role" required>
          <option value="Etudiant">Étudiant</option>
          <option value="Professeur">Professeur</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success me-2">
        <i class="fas fa-save me-1"></i>Save
      </button>
      <button type="button" class="btn btn-secondary" (click)="selectedUser = null">
        <i class="fas fa-times me-1"></i>Cancel
      </button>
    </form>
  </div>

  <!-- Formulaire d'ajout de nouvel utilisateur -->
  <div *ngIf="userForm" class="card p-4 mb-4 shadow-sm">
    <h2 class="card-title mb-4">Add User</h2>
    <form (ngSubmit)="saveNewUser()">
      <div class="mb-3">
        <label for="nom" class="form-label">Nom:</label>
        <input id="nom" type="text" class="form-control" [(ngModel)]="userForm.nom" name="nom" required>
      </div>
      <div class="mb-3">
        <label for="prenom" class="form-label">Prénom:</label>
        <input id="prenom" type="text" class="form-control" [(ngModel)]="userForm.prenom" name="prenom" required>
      </div>
      <div class="mb-3">
        <label for="pseudo" class="form-label">Pseudo:</label>
        <input id="pseudo" type="text" class="form-control" [(ngModel)]="userForm.pseudo" name="pseudo" required>
      </div>
      <div class="mb-3">
        <label for="mail" class="form-label">Email:</label>
        <input id="mail" type="email" class="form-control" [(ngModel)]="userForm.mail" name="mail" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password:</label>
        <input id="password" type="password" class="form-control" [(ngModel)]="userForm.password" name="password" required>
      </div>
      <div class="mb-3">
        <label for="role" class="form-label">Role:</label>
        <select id="role" class="form-select" [(ngModel)]="userForm.role" name="role" required>
          <option value="Etudiant">Étudiant</option>
          <option value="Professeur">Professeur</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success me-2">
        <i class="fas fa-save me-1"></i>Save
      </button>
      <button type="button" class="btn btn-secondary" (click)="userForm = null">
        <i class="fas fa-times me-1"></i>Cancel
      </button>
    </form>
  </div>

  <!-- Tableau des cours pour un utilisateur -->
  <div *ngIf="courses && courses.length > 0" class="mt-5">
    <h2 class="mb-4 text-primary">Courses for User</h2>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-primary">
          <tr>
            <th>ID</th>
            <th>Nom</th>
            <th>Description</th>
            <th>Date Début</th>
            <th>Date Fin</th>
            <th>Disponible</th>
            <th>Professeur ID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let course of courses">
            <td>{{ course.id }}</td>
            <td>{{ course.Nom }}</td>
            <td>{{ course.description || 'Pas de description' }}</td>
            <td>{{ course.dateDebut | date }}</td>
            <td>{{ course.dateFin | date }}</td>
            <td>{{ course.available ? 'Oui' : 'Non' }}</td>
            <td>{{ course.professeurId || 'N/A' }}</td>
            <td>
              <button class="btn btn-info btn-sm me-1" (click)="showEnrolledUsers(course.id!)">Voir Utilisateurs</button>
              <button class="btn btn-primary btn-sm" (click)="showAssignments(course.id!)">Voir Assignements</button>
            
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Utilisateurs inscrits pour un cours -->
  <div *ngIf="selectedCourseWithUsers" class="card mb-4 enrolled-users-form shadow">
    <div class="card-header bg-info text-white">
      <h2>Utilisateurs inscrits pour le cours {{ selectedCourseWithUsers.Nom }}</h2>
    </div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Note</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of enrolledUsers">
            <td>{{ user.nom }} {{ user.prenom }}</td>
            <td>
              <input [(ngModel)]="user.grade" type="number" min="0" max="20" class="form-control" style="width: 80px;" />
            </td>
            <td>
              <!-- <button class="btn btn-success btn-sm me-1" (click)="updateGrade(user.id, selectedCourseWithUsers.id, user.grade)">
                Mettre à jour la Note
              </button> -->
              <button class="btn btn-danger btn-sm me-1" (click)="deleteEnrollment(user.id, selectedCourseWithUsers.id!)">
                Supprimer Inscription
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <app-assignements *ngIf="selectedCourseIdForAssignments" [courseId]="selectedCourseIdForAssignments"></app-assignements>

  <!-- Bouton pour inscrire un étudiant -->

    </div>
  </div>
</div>
  <button class="btn btn-secondary mb-4" (click)="openEnrollStudentDialog()">
    <i class="fas fa-chalkboard-teacher me-2"></i> Inscrire un Étudiant
  </button>